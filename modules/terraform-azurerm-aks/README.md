<!-- BEGIN_TF_DOCS -->
<!--

  ** DO NOT EDIT THIS FILE
  ** This file was automatically generated by using Terraform Docs
  ** 1) Make all changes on files under docs/*.md
  ** 2) Run `terraform-docs .` to rebuild this file
  **
  ** By following this practice we ensure standard and high-quality across multiple projects.
  ** DO NOT EDIT THIS FILE
-->

# Azure Kubernetes service

## Introduction
Provisions an Azure Kubernetes cluster
https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/kubernetes_cluster

### Dependencies

This component depends on the following resources :

- Resource group
- Subnet to be attached to Azure Kubernetes Services
- Private DNS zone ID
- Azure Container Registry ID
- AD Groups to be assigned to Namespace Role Bindings

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >=1.0.0 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) | >= 2.74.0 |
| <a name="requirement_kubernetes"></a> [kubernetes](#requirement\_kubernetes) | 2.16.0 |

## Providers

| Name | Version |
|------|---------|
| <a name="provider_azurerm"></a> [azurerm](#provider\_azurerm) | 3.33.0 |
| <a name="provider_kubernetes"></a> [kubernetes](#provider\_kubernetes) | 2.16.0 |

## Modules

No modules.

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_acr_id"></a> [acr\_id](#input\_acr\_id) | (Required) The resource Id of the Azure Container Registry where container images are stored. The cluster assigned identity will be granted ACRPull access to this ACR. | `string` | n/a | yes |
| <a name="input_aks_subnet_id"></a> [aks\_subnet\_id](#input\_aks\_subnet\_id) | (Required) The resource id of the Endpoint Subnet. | `string` | n/a | yes |
| <a name="input_cluster_node_pool_name"></a> [cluster\_node\_pool\_name](#input\_cluster\_node\_pool\_name) | (Required) The name of the Node Pool which should be created within the Kubernetes Cluster. Changing this forces a new resource to be created. | `string` | n/a | yes |
| <a name="input_dns_prefix"></a> [dns\_prefix](#input\_dns\_prefix) | (Required) DNS prefix specified when creating the managed cluster.  The dns\_prefix must contain between 3 and 45 characters, and can contain only letters, numbers, and hyphens. It must start with a letter and must end with a letter or a number.  Changing this forces a new resource to be created. | `string` | n/a | yes |
| <a name="input_environments"></a> [environments](#input\_environments) | (Required) A list of environments be hosted in this cluster. The environment name will be added to the end of each namespace to differentiate them in the cluster. | `set(string)` | n/a | yes |
| <a name="input_location"></a> [location](#input\_location) | (Required) The location where the Managed Kubernetes Cluster should be created. Changing this forces a new resource to be created. | `string` | n/a | yes |
| <a name="input_name"></a> [name](#input\_name) | (Required) The name of the Managed Kubernetes Cluster to create. Changing this forces a new resource to be created. | `string` | n/a | yes |
| <a name="input_namespace_config"></a> [namespace\_config](#input\_namespace\_config) | (Required) For each namespace/environment combination, this contains the TODO: config... | <pre>map(object({<br>    something=string<br>  }))</pre> | n/a | yes |
| <a name="input_namespaces"></a> [namespaces](#input\_namespaces) | (Required) A list of root namespaces that will be created in each environment. The actual namespace will have the environment name added to the end. | `set(string)` | n/a | yes |
| <a name="input_resource_group_name"></a> [resource\_group\_name](#input\_resource\_group\_name) | (Required) Specifies the Resource Group where the Managed Kubernetes Cluster should exist. Changing this forces a new resource to be created. | `string` | n/a | yes |
| <a name="input_aad_integration_managed"></a> [aad\_integration\_managed](#input\_aad\_integration\_managed) | (Optional) Is the Azure Active Directory integration Managed, meaning that Azure will create/manage the Service Principal used for integration. Defaults to true. | `string` | `true` | no |
| <a name="input_admin_group_object_ids"></a> [admin\_group\_object\_ids](#input\_admin\_group\_object\_ids) | (Optional) A list of Object IDs of Azure Active Directory Groups which should have Admin Role on the Cluster. | `list(string)` | `null` | no |
| <a name="input_api_server_authorized_ip_ranges"></a> [api\_server\_authorized\_ip\_ranges](#input\_api\_server\_authorized\_ip\_ranges) | (Optional) The IP ranges to allow for incoming traffic to the server nodes. | `set(string)` | `[]` | no |
| <a name="input_automatic_channel_upgrade"></a> [automatic\_channel\_upgrade](#input\_automatic\_channel\_upgrade) | (Optional) The upgrade channel for this Kubernetes Cluster. Possible values are patch, rapid, node-image and stable. Omitting this field sets this value to none. | `string` | `"stable"` | no |
| <a name="input_availability_zones"></a> [availability\_zones](#input\_availability\_zones) | (Optional) A list of Availability Zones across which the Node Pool should be spread. Changing this forces a new resource to be created. | `list(string)` | `null` | no |
| <a name="input_azure_policy_enabled"></a> [azure\_policy\_enabled](#input\_azure\_policy\_enabled) | (Optional) Is the Azure Policy for Kubernetes Add On enabled? Defaults true. | `bool` | `true` | no |
| <a name="input_azure_rbac_enabled"></a> [azure\_rbac\_enabled](#input\_azure\_rbac\_enabled) | (Optional) Is Role Based Access Control based on Azure AD enabled? | `bool` | `true` | no |
| <a name="input_default_node_pool_name"></a> [default\_node\_pool\_name](#input\_default\_node\_pool\_name) | (Optional) The name which should be used for the default Kubernetes Node Pool. Defaults to default. Changing this forces a new resource to be created. | `string` | `"default"` | no |
| <a name="input_disk_encryption_set_id"></a> [disk\_encryption\_set\_id](#input\_disk\_encryption\_set\_id) | (Optional) The ID of the Disk Encryption Set which should be used for the Nodes and Volumes. | `string` | `null` | no |
| <a name="input_dns_service_ip"></a> [dns\_service\_ip](#input\_dns\_service\_ip) | (Optional) IP address within the Kubernetes service address range that will be used by cluster service discovery (kube-dns). Changing this forces a new resource to be created. | `string` | `null` | no |
| <a name="input_docker_bridge_cidr"></a> [docker\_bridge\_cidr](#input\_docker\_bridge\_cidr) | (Required) IP address (in CIDR notation) used as the Docker bridge IP address on nodes. Changing this forces a new resource to be created. | `string` | `null` | no |
| <a name="input_enable_auto_scaling"></a> [enable\_auto\_scaling](#input\_enable\_auto\_scaling) | (Optional) Should the Kubernetes Auto Scaler be enabled for this Node Pool?  Defaults to true. | `bool` | `true` | no |
| <a name="input_enable_host_encryption"></a> [enable\_host\_encryption](#input\_enable\_host\_encryption) | (Optional) Should the nodes in the Default Node Pool have host encryption enabled?  Defaults to false. | `bool` | `false` | no |
| <a name="input_enable_node_public_ip"></a> [enable\_node\_public\_ip](#input\_enable\_node\_public\_ip) | (Optional) Should nodes in this Node Pool have a Public IP Address? Defaults to false. Changing this forces a new resource to be created. | `bool` | `false` | no |
| <a name="input_http_application_routing_enabled"></a> [http\_application\_routing\_enabled](#input\_http\_application\_routing\_enabled) | (Optional) Is HTTP Application Routing Enabled? Defaults to true. | `bool` | `false` | no |
| <a name="input_identity_type"></a> [identity\_type](#input\_identity\_type) | (Optional) The type of identity used for the managed cluster. Defaults to SystemAssigned. Possible values are SystemAssigned and UserAssigned. If UserAssigned is set, at least one entry must be set in user\_assigned\_identity\_ids as well. | `string` | `"SystemAssigned"` | no |
| <a name="input_kubernetes_version"></a> [kubernetes\_version](#input\_kubernetes\_version) | (Optional) Version of Kubernetes specified when creating the AKS managed cluster. If not specified, the latest recommended version will be used at provisioning time (but won't auto-upgrade). | `string` | `null` | no |
| <a name="input_linux_profile"></a> [linux\_profile](#input\_linux\_profile) | (Optional) define Admin username and SSH key used to log into nodes | <pre>object({<br>    admin_username = string<br>    key_data       = string<br>  })</pre> | `null` | no |
| <a name="input_max_node_count"></a> [max\_node\_count](#input\_max\_node\_count) | (Optional) The maximum number of nodes which should exist in this Node Pool. If specified this must be between 1 and 1000. Defaults to 3. | `number` | `3` | no |
| <a name="input_max_pods"></a> [max\_pods](#input\_max\_pods) | (Optional) The maximum number of pods that can run on each agent. Changing this forces a new resource to be created. | `number` | `null` | no |
| <a name="input_min_node_count"></a> [min\_node\_count](#input\_min\_node\_count) | (Optional) The minimum number of nodes which should exist in this Node Pool. If specified this must be between 1 and 1000. Defaults to 1. | `number` | `1` | no |
| <a name="input_node_count"></a> [node\_count](#input\_node\_count) | (Optional) The number of nodes which should exist within this Node Pool. Valid values are between 0 and 1000 (inclusive). This value must be between min\_node\_count and max\_node\_count (inclusioe) and must be specified if enable\_auto\_scaling is set to False. | `number` | `1` | no |
| <a name="input_node_labels"></a> [node\_labels](#input\_node\_labels) | (Optional) A map of Kubernetes labels which should be applied to nodes in the Default Node Pool. Changing this forces a new resource to be created. | `map(string)` | `{}` | no |
| <a name="input_node_pool_type"></a> [node\_pool\_type](#input\_node\_pool\_type) | (Optional) The type of Node Pool which should be created. Possible values are AvailabilitySet and VirtualMachineScaleSets. Defaults to VirtualMachineScaleSets. | `string` | `"VirtualMachineScaleSets"` | no |
| <a name="input_node_resource_group"></a> [node\_resource\_group](#input\_node\_resource\_group) | (Optional) The name of the Resource Group where the Kubernetes Nodes should exist.  Changing this forces a new resource to be created.  Azure requires that a new, non-existent Resource Group is used. | `string` | `null` | no |
| <a name="input_orchestrator_version"></a> [orchestrator\_version](#input\_orchestrator\_version) | (Optional) Version of Kubernetes used for the Agents. If not specified, the latest recommended version will be used at provisioning time (but won't auto-upgrade) | `string` | `null` | no |
| <a name="input_os_disk_size_gb"></a> [os\_disk\_size\_gb](#input\_os\_disk\_size\_gb) | (Optional) The size of the OS Disk which should be used for each agent in the Node Pool. Defaults to 120. Changing this forces a new resource to be created. | `number` | `120` | no |
| <a name="input_outbound_type"></a> [outbound\_type](#input\_outbound\_type) | (Optional) The outbound (egress) routing method which should be used for this Kubernetes Cluster. Possible values are loadBalancer and userDefinedRouting. Defaults to loadBalancer. | `string` | `"loadBalancer"` | no |
| <a name="input_private_cluster_enabled"></a> [private\_cluster\_enabled](#input\_private\_cluster\_enabled) | (Optional) Should this Kubernetes Cluster have its API server only exposed on internal IP addresses? This provides a Private IP Address for the Kubernetes API on the Virtual Network where the Kubernetes Cluster is located. Defaults to true. Changing this forces a new resource to be created. | `bool` | `true` | no |
| <a name="input_private_dns_zone_id"></a> [private\_dns\_zone\_id](#input\_private\_dns\_zone\_id) | (Optional) Either the ID of Private DNS Zone which should be delegated to this Cluster, Values are System, None, or your private dns zone ID | `string` | `"System"` | no |
| <a name="input_rbac_enabled"></a> [rbac\_enabled](#input\_rbac\_enabled) | (Optional) Is Role Based Access Control based on Azure AD enabled? Defaults to true. | `bool` | `true` | no |
| <a name="input_secret_rotation_enabled"></a> [secret\_rotation\_enabled](#input\_secret\_rotation\_enabled) | (Optional) Is secret rotation enabled? Must be present if enabled is true. | `bool` | `false` | no |
| <a name="input_secret_rotation_interval"></a> [secret\_rotation\_interval](#input\_secret\_rotation\_interval) | (Optional) The interval to poll for secret rotation. This attribute is only set when secret\_rotation is true and defaults to 2m. | `string` | `"2m"` | no |
| <a name="input_service_cidr"></a> [service\_cidr](#input\_service\_cidr) | (Optional) The Network Range used by the Kubernetes service. Changing this forces a new resource to be created. | `string` | `null` | no |
| <a name="input_sku_tier"></a> [sku\_tier](#input\_sku\_tier) | (Optional) The SKU Tier that should be used for this Kubernetes Cluster. Possible values are Free and Paid (which includes the Uptime SLA). Defaults to Paid. Changing this forces a new resource to be created. | `string` | `"Paid"` | no |
| <a name="input_tags"></a> [tags](#input\_tags) | (Optional) Tags to apply to the resources where possible. | `map(string)` | `null` | no |
| <a name="input_tenant_id"></a> [tenant\_id](#input\_tenant\_id) | (Optional) The Tenant ID used for Azure Active Directory Application. If this isn't specified the Tenant ID of the current Subscription is used. | `string` | `null` | no |
| <a name="input_user_assigned_identity_ids"></a> [user\_assigned\_identity\_ids](#input\_user\_assigned\_identity\_ids) | (Optional) A list of user assigned identity ids. | `list(string)` | `[]` | no |
| <a name="input_vm_size"></a> [vm\_size](#input\_vm\_size) | (Optional) The size of the Virtual Machines that will form the default node pool. Defaults to Standard\_D4s\_v3. | `string` | `"Standard_D4s_v3"` | no |

## Outputs

| Name | Description |
|------|-------------|
| <a name="output_fqdn"></a> [fqdn](#output\_fqdn) | Returns the FQDN (Fully Qualified Domain Name) of the AKS cluster. |
| <a name="output_id"></a> [id](#output\_id) | Returns the resource ID of the AKS cluster. |
| <a name="output_identity"></a> [identity](#output\_identity) | Returns the identity of the AKS cluster. |
| <a name="output_kube_admin_config"></a> [kube\_admin\_config](#output\_kube\_admin\_config) | Returns the kube admin config of the AKS cluster. This is only available when Role Based Access Control with Azure Active Directory is enabled. |
| <a name="output_kube_config"></a> [kube\_config](#output\_kube\_config) | Returns the kube config of the AKS cluster. |
| <a name="output_kube_config_raw"></a> [kube\_config\_raw](#output\_kube\_config\_raw) | Returns the raw kube config of the AKS cluster. |
| <a name="output_kubelet_identity"></a> [kubelet\_identity](#output\_kubelet\_identity) | Returns the Kubelet Identity. |
| <a name="output_kubernetes_version"></a> [kubernetes\_version](#output\_kubernetes\_version) | Returns the kubernetes version of the AKS cluster. |
| <a name="output_name"></a> [name](#output\_name) | Returns the Name of the AKS cluster. |

### Using it in a blueprint

IMPORTANT: We periodically release versions for the components. Since, master branch may have breaking changes, best practice would be to use a released version in form of a tag (e.g. ?ref=x.y.z)

```terraform
module "aks" {
  source                          = "git@gitlab.com:--GITREPONAME--/terraform-azurerm-aks?ref=v1.0"
  name                            = var.aks_name
  resource_group_name             = module.aks_resource_group.name
  kubernetes_version              = var.kubernetes_version
  aks_subnet_id                   = var.aks_subnet_id
  location                        = var.location
  api_server_authorized_ip_ranges = var.api_server_authorized_ip_ranges
  automatic_channel_upgrade       = var.automatic_channel_upgrade
  node_resource_group             = var.node_resource_group
  dns_prefix                      = var.dns_prefix
  availability_zones              = var.availability_zones
  dns_service_ip                  = var.dns_service_ip
  service_cidr                    = var.service_cidr
  docker_bridge_cidr              = var.docker_bridge_cidr
  admin_group_object_ids          = var.admin_group_object_ids
  monitoring_insights_enabled     = var.monitoring_insights_enabled
  log_analytics_workspace_id      = var.log_analytics_workspace_id
  private_cluster_enabled         = var.private_cluster_enabled
  cluster_node_pool_name          = var.cluster_node_pool_name
  outbound_type                   = var.outbound_type

}
```
### Test Vars

A sample list of input vars is located in `tests\vars\input.tfvars`

## Testing

You can use below commands to execute the terraform scripts in local

```bash
terraform init
terraform plan -out QuickstartTerraformTest.tfplan -var-file=.\tests\vars\input.tfvars
terraform apply QuickstartTerraformTest.tfplan
```

### Automated testing

The following set of commands can be executed to execute unit testing and integration testing from your local system.

```bash
go get github.com/stretchr/testify/assert
go get github.com/gruntwork-io/terratest/modules/terraform
go test
```
<!-- END_TF_DOCS -->